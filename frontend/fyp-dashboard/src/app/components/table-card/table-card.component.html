<mat-card class="custom-card">
  <div class="card-header">
    <h3 class="card-title">{{ title }}</h3>
    <button mat-mini-fab [matMenuTriggerFor]="menu" aria-label="View options">
      <mat-icon>bar_chart</mat-icon>
    </button>
    <mat-menu #menu="matMenu">
      <button mat-menu-item (click)="setView('table')">Table</button>
      <button mat-menu-item (click)="setView('bar')">Bar Graph</button>
      <button mat-menu-item (click)="setView('pie')">Pie Chart</button>
    </mat-menu>
  </div>

  <div class="content-container">
    <!-- TABLE VIEW -->
    <ng-container *ngIf="viewType === 'table'">
      <ng-container *ngIf="dataSource.data.length || !isLoading; else loading">
        <div class="table-wrapper">
          <div class="table-scroll" *ngIf="dataSource.data.length; else noData">
            <table mat-table [dataSource]="dataSource" class="custom-table">
              <ng-container *ngFor="let col of displayedColumns" [matColumnDef]="col">
                <th mat-header-cell *matHeaderCellDef>{{ col }}</th>
                <td mat-cell *matCellDef="let el">
                  <span class="truncated" [matTooltip]="el[col]" matTooltipPosition="above">
                    {{ el[col]?.length > 20 ? (el[col] | slice : 0 : 20) + "â€¦" : el[col] }}
                  </span>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
            </table>
          </div>

          <ng-template #noData>
            <div class="no-data-message">
              <mat-icon>info</mat-icon>
              <p>No data available for the selected date range</p>
            </div>
          </ng-template>

          <mat-paginator [pageSize]="pageSize" [showFirstLastButtons]="true" [length]="length"
            (page)="onPageChange($event)"></mat-paginator>

          <div class="overlay-spinner" *ngIf="isLoading">
            <div class="loading-spinner"></div>
          </div>
        </div>
      </ng-container>

      <ng-template #loading>
        <div class="overlay-spinner">
          <div class="loading-spinner"></div>
        </div>
      </ng-template>
    </ng-container>

    <!-- CHART VIEW -->
    <ng-container *ngIf="viewType !== 'table'">
      <div class="loader-container" *ngIf="isLoading || !chartData">
        <mat-spinner></mat-spinner>
      </div>
      <div class="chart-container" *ngIf="chartData">
        <canvas baseChart [data]="chartData" [options]="viewType === 'pie' ? pieChartOptions : chartOptions"
          [type]="chartType" width="600" height="270"></canvas>
      </div>
    </ng-container>
  </div>
</mat-card>