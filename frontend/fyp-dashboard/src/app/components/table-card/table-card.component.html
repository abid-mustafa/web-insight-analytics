<mat-card class="custom-card">
  <div class="card-header">
    <h3 class="card-title">{{ title }}</h3>
    <button mat-mini-fab [matMenuTriggerFor]="menu" aria-label="View options">
      <mat-icon>bar_chart</mat-icon>
    </button>
    <mat-menu #menu="matMenu">
      <button mat-menu-item (click)="setView('table')">Table</button>
      <button mat-menu-item (click)="setView('bar')">Bar Graph</button>
      <button mat-menu-item (click)="setView('pie')">Pie Chart</button>
    </mat-menu>
  </div>

  <div class="content-container">
    <!-- TABLE VIEW -->
    <ng-container *ngIf="viewType === 'table'">
      <ng-container *ngIf="dataSource.data.length; else initialLoading">
        <div class="table-wrapper">
          <div class="table-scroll">
            <table mat-table [dataSource]="dataSource" class="custom-table">
              <ng-container *ngFor="let col of displayedColumns" [matColumnDef]="col">
                <th mat-header-cell *matHeaderCellDef> {{ col }} </th>
                <td mat-cell *matCellDef="let el">
                  <span
                    class="truncated"
                    [matTooltip]="el[col]"
                    matTooltipPosition="above"
                  >
                    {{ el[col]?.length > 20 ? (el[col] | slice: 0:20) + 'â€¦' : el[col] }}
                  </span>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
            </table>
          </div>

          <mat-paginator
            [pageSize]="pageSize"
            [showFirstLastButtons]="true"
            [length]="length"
            (page)="onPageChange($event)"
          ></mat-paginator>

          <div class="overlay-spinner" *ngIf="isLoading">
            <mat-spinner diameter="40"></mat-spinner>
          </div>
        </div>
      </ng-container>

      <ng-template #initialLoading>
        <div class="loader-container">
          <mat-spinner></mat-spinner>
        </div>
      </ng-template>
    </ng-container>

    <!-- CHART VIEW -->
    <ng-container *ngIf="viewType !== 'table'">
      <div class="loader-container" *ngIf="isLoading || !chartData">
        <mat-spinner></mat-spinner>
      </div>
      <div class="chart-container" *ngIf="chartData">
        <canvas
          baseChart
          [data]="chartData"
          [options]="viewType === 'pie' ? pieChartOptions : chartOptions"
          [type]="chartType"
          width="600"
          height="270"
        ></canvas>
      </div>
    </ng-container>
  </div>
</mat-card>
